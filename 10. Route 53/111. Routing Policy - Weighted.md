## âš–ï¸ Route 53 - **Weighted Routing Policy**

### 1. **Weighted Routing Policy** lÃ  gÃ¬?

* Cho phÃ©p báº¡n **Ä‘iá»u khiá»ƒn pháº§n trÄƒm request** Ä‘Æ°á»£c gá»­i Ä‘áº¿n tá»«ng resource khÃ¡c nhau báº±ng cÃ¡ch gÃ¡n **trá»ng sá»‘ (weight)**.
* VÃ­ dá»¥: CÃ³ 3 EC2 instance, gÃ¡n weight lÃ  70, 20, vÃ  10 â†’ 70% DNS responses sáº½ trá» Ä‘áº¿n instance Ä‘áº§u tiÃªn, 20% Ä‘áº¿n cÃ¡i thá»© hai, 10% Ä‘áº¿n cÃ¡i cÃ²n láº¡i.

---

### 2. CÃ¡ch hoáº¡t Ä‘á»™ng:

* GÃ¡n má»—i record má»™t **weight tÆ°Æ¡ng Ä‘á»‘i**.

* Tá»· lá»‡ traffic sáº½ Ä‘Æ°á»£c tÃ­nh theo cÃ´ng thá»©c:

  ```
  % traffic = (weight cá»§a record Ä‘Ã³) / (tá»•ng táº¥t cáº£ weight)
  ```

* **Weight khÃ´ng cáº§n pháº£i cá»™ng láº¡i thÃ nh 100**, chá»‰ cáº§n thá»ƒ hiá»‡n má»©c Ä‘á»™ Æ°u tiÃªn tÆ°Æ¡ng Ä‘á»‘i.

---

### 3. YÃªu cáº§u ká»¹ thuáº­t:

* **Táº¥t cáº£ record** pháº£i cÃ³ cÃ¹ng **tÃªn (name)** vÃ  **loáº¡i (type)** (vÃ­ dá»¥ cÃ¹ng lÃ  A record).
* CÃ³ thá»ƒ **gáº¯n kÃ¨m Health Check** Ä‘á»ƒ kiá»ƒm tra tÃ¬nh tráº¡ng endpoint (sáº½ há»c á»Ÿ pháº§n sau).

---

### 4. ğŸ’¡ Use Cases:

* **Load Balancing** giá»¯a cÃ¡c EC2 instance hoáº·c vÃ¹ng (region).
* **Canary Deployment / Blue-Green Deployment**: test phiÃªn báº£n á»©ng dá»¥ng má»›i báº±ng cÃ¡ch gá»­i má»™t pháº§n nhá» traffic.
* **Zero Weight** â†’ khÃ´ng gá»­i traffic Ä‘áº¿n resource Ä‘Ã³.
* Náº¿u **táº¥t cáº£ weights = 0** â†’ Route 53 tráº£ vá» táº¥t cáº£ báº£n ghi vá»›i **trá»ng sá»‘ báº±ng nhau**.

---

### 5. ğŸ›  Demo táº¡o Weighted Record:

#### BÆ°á»›c 1: Táº¡o record `weighted.stephanetheteacher.com`

* Loáº¡i: **A Record**
* TTL: 3 giÃ¢y (dÃ¹ng Ä‘á»ƒ test, khÃ´ng nÃªn dÃ¹ng tháº­t)

#### BÆ°á»›c 2: ThÃªm 3 record vá»›i thÃ´ng tin:

| Region         | IP Address (vÃ­ dá»¥) | Weight | Record ID |
| -------------- | ------------------ | ------ | --------- |
| ap-southeast-1 | x.x.x.x            | 10     | southeast |
| us-east-1      | y.y.y.y            | 70     | us-east   |
| eu-central-1   | z.z.z.z            | 20     | eu        |

#### BÆ°á»›c 3: Kiá»ƒm tra

* Truy cáº­p URL: `weighted.stephanetheteacher.com`
* Káº¿t quáº£ tráº£ vá» chá»§ yáº¿u lÃ  IP á»Ÿ `us-east-1` (70% weight).
* Thá»‰nh thoáº£ng sáº½ tháº¥y káº¿t quáº£ tá»« cÃ¡c vÃ¹ng khÃ¡c do tá»‰ lá»‡ 10% vÃ  20%.

---

### 6. ğŸ§ª Sá»­ dá»¥ng `dig` Ä‘á»ƒ kiá»ƒm tra:

```bash
dig weighted.stephanetheteacher.com
```

* TTL hiá»ƒn thá»‹ lÃ  3
* IP tráº£ vá» thay Ä‘á»•i tÃ¹y theo weight

---

## âœ… Tá»•ng káº¿t:

* **Weighted Routing Policy** giÃºp Ä‘iá»u khiá»ƒn phÃ¢n phá»‘i traffic linh hoáº¡t theo tá»· lá»‡.
* PhÃ¹ há»£p cho:

  * **PhÃ¢n phá»‘i táº£i (Load Balancing)**
  * **Triá»ƒn khai thá»­ nghiá»‡m (Canary / Blue-Green)**
  * **Táº¡m thá»i táº¯t endpoint (set weight = 0)**
* Há»— trá»£ **gáº¯n Health Check**.
* YÃªu cáº§u: CÃ¡c báº£n ghi pháº£i cÃ¹ng **tÃªn vÃ  loáº¡i**.

---
