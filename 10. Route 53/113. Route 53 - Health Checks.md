## ü©∫ Route 53 - **Health Checks**

### 1. Health Check l√† g√¨?

* **Health Checks** l√† c√°ch ƒë·ªÉ ki·ªÉm tra **t√¨nh tr·∫°ng ho·∫°t ƒë·ªông** (s·ª©c kh·ªèe) c·ªßa t√†i nguy√™n.
* Ch·ªß y·∫øu d√†nh cho **public resources**, nh∆∞ng c≈©ng c√≥ c√°ch √°p d·ª•ng cho **private resources** th√¥ng qua **CloudWatch Alarm**.

---

### 2. M·ª•c ƒë√≠ch s·ª≠ d·ª•ng

* V√≠ d·ª•: C√≥ 2 **Load Balancer** ƒë·∫∑t t·∫°i 2 **region** kh√°c nhau (multi-region setup).
* D√πng Route 53 ƒë·ªÉ ƒë·ªãnh tuy·∫øn ng∆∞·ªùi d√πng ƒë·∫øn region g·∫ßn nh·∫•t (**latency-based routing**).
* Nh∆∞ng n·∫øu m·ªôt region b·ªã **m·∫•t k·∫øt n·ªëi** (down), th√¨ c·∫ßn t·ª± ƒë·ªông **chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng** sang region c√≤n l·∫°i ‚Üí d√πng **health check** ƒë·ªÉ th·ª±c hi·ªán ƒëi·ªÅu n√†y.
* T·∫°o health check cho t·ª´ng endpoint (v√≠ d·ª•: `us-east-1`, `eu-west-1`), r·ªìi **g√°n v√†o Route 53 record** ƒë·ªÉ k√≠ch ho·∫°t **DNS failover** t·ª± ƒë·ªông.

---

### 3. C√°c lo·∫°i **Health Check** trong Route 53

| Lo·∫°i Health Check           | M√¥ t·∫£                                                                  |
| --------------------------- | ---------------------------------------------------------------------- |
| **Endpoint Health Check**   | Ki·ªÉm tra m·ªôt endpoint c√¥ng khai (HTTP, HTTPS, TCP)                     |
| **Calculated Health Check** | K·∫øt h·ª£p nhi·ªÅu health check con (OR, AND, NOT) th√†nh m·ªôt check cha      |
| **CloudWatch Alarm Check**  | D·ª±a v√†o tr·∫°ng th√°i c·ªßa **CloudWatch Alarm**, d√πng cho private resource |

---

### 4. Chi ti·∫øt v·ªÅ **Endpoint Health Check**

* AWS c√≥ kho·∫£ng **15 global health checkers** (to√†n c·∫ßu) g·ª≠i y√™u c·∫ßu ƒë·∫øn endpoint.
* N·∫øu endpoint tr·∫£ v·ªÅ m√£ **HTTP 2xx ho·∫∑c 3xx**, th√¨ xem l√† **healthy**.
* C√≥ th·ªÉ t√πy ch·ªçn giao th·ª©c: **HTTP**, **HTTPS**, **TCP**.
* Kho·∫£ng th·ªùi gian ki·ªÉm tra:

  * **30 gi√¢y** (b√¨nh th∆∞·ªùng)
  * **10 gi√¢y** (fast health check, t·ªën ph√≠ h∆°n)
* Quy t·∫Øc ƒë√°nh gi√°:

  * N·∫øu tr√™n **18% health checkers** ƒë√°nh gi√° l√† healthy ‚Üí xem nh∆∞ **healthy**
* C√≥ th·ªÉ ch·ªâ ƒë·ªãnh **v·ªã tr√≠ ƒë·ªãa l√Ω** c·ªßa c√°c health checker ƒë∆∞·ª£c s·ª≠ d·ª•ng.
* C√≥ th·ªÉ ki·ªÉm tra c·∫£ **n·ªôi dung vƒÉn b·∫£n tr·∫£ v·ªÅ** (t·ªëi ƒëa 5,120 bytes) ƒë·ªÉ t√¨m chu·ªói c·ª• th·ªÉ.
* **Ph·∫£i m·ªü firewall/Security Group** ƒë·ªÉ cho ph√©p c√°c IP c·ªßa Route 53 health checker truy c·∫≠p ƒë∆∞·ª£c endpoint.

  * IP n√†y c√≥ th·ªÉ tra c·ª©u t·∫°i trang ch√≠nh th·ª©c c·ªßa AWS.

---

### 5. **Calculated Health Check** (T√≠nh to√°n)

* D√πng ƒë·ªÉ k·∫øt h·ª£p k·∫øt qu·∫£ t·ª´ **nhi·ªÅu health check con**.
* V√≠ d·ª•:

  * C√≥ 3 EC2 instances ‚Üí t·∫°o 3 health check con
  * T·∫°o m·ªôt **health check cha** d√πng c√°c ƒëi·ªÅu ki·ªán logic: **AND**, **OR**, **NOT**
* C√≥ th·ªÉ theo d√µi t·ªëi ƒëa **256 health check con**
* C√≥ th·ªÉ ch·ªâ ƒë·ªãnh s·ªë l∆∞·ª£ng health check con c·∫ßn pass ƒë·ªÉ health check cha pass
* ·ª®ng d·ª•ng th·ª±c t·∫ø: Duy tr√¨ ho·∫°t ƒë·ªông khi b·∫£o tr√¨ m·ªôt ph·∫ßn h·ªá th·ªëng (m·ªôt v√†i check fail nh∆∞ng v·∫´n kh√¥ng ·∫£nh h∆∞·ªüng to√†n b·ªô)

---

### 6. Gi√°m s√°t **private resource**

* C√°c **Route 53 health checker** n·∫±m **ngo√†i VPC**, kh√¥ng th·ªÉ truy c·∫≠p v√†o **private endpoint**.
* C√°ch l√†m:

  * T·∫°o m·ªôt **CloudWatch Metric** theo d√µi tr·∫°ng th√°i c·ªßa t√†i nguy√™n (v√≠ d·ª•: EC2 trong subnet private)
  * T·∫°o **CloudWatch Alarm** tr√™n metric n√†y
  * G√°n **CloudWatch Alarm** n√†y v√†o **Route 53 health check**
  * Khi Alarm v√†o tr·∫°ng th√°i `ALARM` ‚Üí resource ƒë∆∞·ª£c coi l√† **unhealthy**
* ƒê√¢y l√† **c√°ch ph·ªï bi·∫øn nh·∫•t** ƒë·ªÉ gi√°m s√°t private resource v·ªõi Route 53.

---

## ‚úÖ T·ªïng k·∫øt

| T√≠nh nƒÉng                    | M√¥ t·∫£                                                    |
| ---------------------------- | -------------------------------------------------------- |
| ƒê·ªãnh tuy·∫øn khi l·ªói           | T·ª± ƒë·ªông DNS failover khi m·ªôt endpoint kh√¥ng ho·∫°t ƒë·ªông    |
| Ph√¢n lo·∫°i Health Check       | Endpoint, Calculated, CloudWatch Alarm                   |
| Giao th·ª©c h·ªó tr·ª£             | HTTP, HTTPS, TCP                                         |
| T√≠ch h·ª£p gi√°m s√°t            | K·∫øt n·ªëi v·ªõi **CloudWatch Metrics & Alarm**               |
| Ph·∫°m vi gi√°m s√°t             | C·∫£ t√†i nguy√™n **public** l·∫´n **private**                 |
| ƒêi·ªÅu ki·ªán ƒë√°nh gi√° "healthy" | Tr·∫£ m√£ **2xx/3xx** ho·∫∑c k·∫øt qu·∫£ t·ªët t·ª´ CloudWatch        |
| C·∫•u h√¨nh n√¢ng cao            | Theo d√µi n·ªôi dung response, ch·ªçn location health checker |

---
