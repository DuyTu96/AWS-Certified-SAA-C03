# 78. Network Load Balancer (NLB) - Hands On

## ğŸ§ª **Thá»±c hÃ nh táº¡o Network Load Balancer (NLB)**

### ğŸ› ï¸ **BÆ°á»›c 1: Táº¡o Network Load Balancer**

* Táº¡o NLB cÃ³ tÃªn: `DemoNLB`.
* Chá»n loáº¡i: **Internet-facing**, **IPv4**.
* Chá»n **VPC hiá»‡n cÃ³** vÃ  **cÃ¡c Availability Zone (AZ)** tÆ°Æ¡ng á»©ng.

  * Vá»›i má»—i AZ Ä‘Æ°á»£c kÃ­ch hoáº¡t, AWS sáº½ cáº¥p má»™t **IPv4 address cá»‘ Ä‘á»‹nh**.
  * CÃ³ thá»ƒ thay tháº¿ báº±ng **Elastic IP** náº¿u muá»‘n Ä‘á»‹a chá»‰ IP cá»‘ Ä‘á»‹nh cá»¥ thá»ƒ.

---

### ğŸ” **BÆ°á»›c 2: GÃ¡n Security Group cho NLB**

* Táº¡o **Security Group**: `demo-sg-nlb`.

  * **Inbound Rule**: Cho phÃ©p **HTTP (port 80)** tá»« **anywhere**.
  * **Outbound Rule**: giá»¯ máº·c Ä‘á»‹nh.
* GÃ¡n security group nÃ y cho NLB (gá»¡ security group máº·c Ä‘á»‹nh náº¿u cÃ³).
* ğŸ“Œ TÆ°Æ¡ng tá»± nhÆ° ALB, giá» Ä‘Ã¢y **NLB cÅ©ng há»— trá»£ Security Group** (tÃ­nh nÄƒng má»›i).

---

### ğŸ” **BÆ°á»›c 3: Listener vÃ  Routing**

* Táº¡o **listener** dÃ¹ng giao thá»©c **TCP** trÃªn **port 80**.
* Táº¡o **Target Group**: `demo-tg-nlb`.

  * **Type**: EC2 Instances.
  * **Protocol**: TCP trÃªn port 80.
  * **Health Check**: dÃ¹ng **HTTP** vÃ¬ backend lÃ  web app.

    * **Healthy threshold**: 2
    * **Timeout**: 2 giÃ¢y
    * **Interval**: 5 giÃ¢y

---

### ğŸ§© **BÆ°á»›c 4: ÄÄƒng kÃ½ EC2 Instance vÃ o Target Group**

* Chá»n cÃ¡c EC2 instance cÃ³ sáºµn â†’ **register** vÃ o target group.

---

### ğŸš§ **BÆ°á»›c 5: Kiá»ƒm tra lá»—i Health Check**

* Ban Ä‘áº§u **target** hiá»ƒn thá»‹ lÃ  **unhealthy**.
* Kiá»ƒm tra lÃ½ do:

  * **EC2 instance chá»‰ cho phÃ©p HTTP tá»« ALB**, chÆ°a cho phÃ©p tá»« NLB.
* CÃ¡ch kháº¯c phá»¥c:

  * Má»Ÿ Security Group cá»§a EC2 instance.
  * ThÃªm rule: **cho phÃ©p HTTP tá»« security group `demo-sg-nlb`** (NLB).

---

### âœ… **BÆ°á»›c 6: XÃ¡c nháº­n hoáº¡t Ä‘á»™ng**

* Sau khi má»Ÿ Ä‘Ãºng rule, target chuyá»ƒn sang tráº¡ng thÃ¡i **healthy**.
* Truy cáº­p URL cá»§a NLB trong trÃ¬nh duyá»‡t sáº½ tháº¥y káº¿t quáº£ **Hello World**.
* Sau khi F5 nhiá»u láº§n, IP hiá»ƒn thá»‹ thay Ä‘á»•i â†’ chá»©ng minh **load balancing giá»¯a 2 instance**.

---

### ğŸ§¹ **BÆ°á»›c 7: Dá»n dáº¹p tÃ i nguyÃªn (náº¿u muá»‘n tiáº¿t kiá»‡m chi phÃ­)**

* **XÃ³a**:

  * `DemoNLB`
  * `demo-tg-nlb` (target group)
  * `demo-sg-nlb` (security group â€“ tuá»³ chá»n)

---

## âœ… **Tá»•ng káº¿t kiáº¿n thá»©c rÃºt ra:**

| Háº¡ng má»¥c                         | Ghi chÃº                                           |
| -------------------------------- | ------------------------------------------------- |
| NLB há»— trá»£ security group?       | âœ… CÃ³ â€“ giá»‘ng ALB                                  |
| Health check cá»§a NLB             | TCP, HTTP, HTTPS                                  |
| IP cá»‘ Ä‘á»‹nh cho má»—i AZ            | âœ… CÃ³ â€“ cÃ³ thá»ƒ thay báº±ng **Elastic IP**            |
| Giao thá»©c listener NLB           | TCP, UDP, TLS, TCP\_UDP                           |
| EC2 bá»‹ unhealthy ban Ä‘áº§u         | âŒ Do chÆ°a cho phÃ©p HTTP tá»« security group cá»§a NLB |
| Kiá»ƒm tra hoáº¡t Ä‘á»™ng load balancer | âœ… Hello World + IP thay Ä‘á»•i khi F5                |

---

