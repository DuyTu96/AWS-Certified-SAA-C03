# 88. Auto Scaling Groups - Scaling Policies Hands On

### ðŸ“Œ **Tá»± Ä‘á»™ng má»Ÿ rá»™ng (Automatic Scaling) cho Auto Scaling Group (ASG)**

Trong AWS, viá»‡c tá»± Ä‘á»™ng má»Ÿ rá»™ng ASG Ä‘Æ°á»£c chia lÃ m 3 loáº¡i chÃ­nh:

---

### 1. **Scheduled Actions**

* Cho phÃ©p báº¡n **lÃªn lá»‹ch** cÃ¡c hÃ nh Ä‘á»™ng má»Ÿ rá»™ng/thu háº¹p trong tÆ°Æ¡ng lai.
* Báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh:

  * **Desired capacity**, **Min capacity**, hoáº·c **Max capacity**,
  * Khoáº£ng thá»i gian thá»±c thi (vÃ­ dá»¥: má»—i tuáº§n, má»—i giá», hoáº·c thá»i Ä‘iá»ƒm cá»¥ thá»ƒ),
  * **Start time** vÃ  **End time**.
* Há»¯u Ã­ch khi báº¡n biáº¿t trÆ°á»›c sá»± kiá»‡n nhÆ° cháº¡y **khuyáº¿n mÃ£i vÃ o thá»© Báº£y**.

---

### 2. **Predictive Scaling Policies**

* **Dá»±a trÃªn Machine Learning**, sá»­ dá»¥ng dá»¯ liá»‡u quÃ¡ khá»© Ä‘á»ƒ **dá»± Ä‘oÃ¡n táº£i (forecast)**.
* Cáº§n xÃ¡c Ä‘á»‹nh **metric chÃ­nh** nhÆ°:

  * `CPU Utilization`,
  * `NetworkIn`, `NetworkOut`,
  * `Application Load Balancer RequestCount`,
  * Hoáº·c **custom metric**.
* VÃ­ dá»¥: báº¡n Ä‘áº·t **target = 50% CPU**, ASG sáº½ dá»± bÃ¡o táº£i vÃ  tá»± Ä‘á»™ng má»Ÿ rá»™ng phÃ¹ há»£p.
* **KhÃ´ng cáº§n viáº¿t mÃ£ nhiá»u**, chá»‰ cáº§n cáº¥u hÃ¬nh vÃ  chá» forecast cÃ³ hiá»‡u lá»±c sau má»™t thá»i gian dÃ i.

---

### 3. **Dynamic Scaling Policies** (cÃ³ thá»ƒ thá»±c thi ngay láº­p tá»©c)

Gá»“m 3 kiá»ƒu:

#### a. **Simple Scaling**

* Cáº§n táº¡o **CloudWatch Alarm** trÆ°á»›c.
* Khi alarm Ä‘Æ°á»£c kÃ­ch hoáº¡t:

  * CÃ³ thá»ƒ thÃªm sá»‘ lÆ°á»£ng EC2 cá»¥ thá»ƒ (e.g., +2),
  * Hoáº·c tÄƒng theo % (e.g., +10% tá»•ng sá»‘ hiá»‡n táº¡i).
* HÃ nh Ä‘á»™ng xáº£y ra **khi alarm chuyá»ƒn sang tráº¡ng thÃ¡i Alarm**.

#### b. **Step Scaling**

* **Dá»±a trÃªn má»©c Ä‘á»™ alarm**, thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng khÃ¡c nhau.

  * VÃ­ dá»¥: náº¿u CPU vÆ°á»£t 90%, thÃªm 10 instance.
  * Náº¿u chá»‰ vÆ°á»£t 60%, thÃªm 1 instance.
* Cho phÃ©p kiá»ƒm soÃ¡t linh hoáº¡t tÃ¹y theo Ä‘á»™ nghiÃªm trá»ng.

#### c. **Target Tracking Scaling** âœ… (Ä‘Æ°á»£c khuyÃªn dÃ¹ng nháº¥t)

* ÄÆ¡n giáº£n, dá»… dÃ¹ng.
* Tá»± Ä‘á»™ng táº¡o **CloudWatch Alarms**.
* Báº¡n chá»‰ cáº§n Ä‘áº·t má»¥c tiÃªu (e.g., `CPU utilization = 40%`).
* ASG sáº½ tá»± thÃªm hoáº·c giáº£m sá»‘ lÆ°á»£ng EC2 Ä‘á»ƒ giá»¯ metric gáº§n vá»›i giÃ¡ trá»‹ má»¥c tiÃªu.
* CÃ¡c alarm Ä‘Æ°á»£c táº¡o bao gá»“m:

  * `AlarmHigh`: scale out khi CPU > 40%,
  * `AlarmLow`: scale in khi CPU < 28%.

---

### ðŸ” **Demo thá»±c táº¿ (Target Tracking)**

* TÄƒng CPU báº±ng lá»‡nh `stress -c 4` lÃ m CPU Ä‘áº¡t 100%.
* Káº¿t quáº£:

  * AlarmHigh Ä‘Æ°á»£c kÃ­ch hoáº¡t â†’ ASG scale tá»« 1 â†’ 2 â†’ 3 instance.
* Khi dá»«ng stress:

  * CPU giáº£m â†’ AlarmLow Ä‘Æ°á»£c kÃ­ch hoáº¡t â†’ ASG giáº£m instance xuá»‘ng 2 â†’ 1.

---

### âš™ï¸ Má»™t sá»‘ lÆ°u Ã½ quan trá»ng:

* **Scaling Cooldown**:

  * Sau má»—i scaling, ASG sáº½ chá» **máº·c Ä‘á»‹nh 300 giÃ¢y (5 phÃºt)** Ä‘á»ƒ chá» metric á»•n Ä‘á»‹nh.
  * CÃ³ thá»ƒ Ä‘iá»u chá»‰nh thá»i gian nÃ y Ä‘á»ƒ scaling nhanh hÆ¡n.

* **Sá»­ dá»¥ng AMI sáºµn sÃ ng**:

  * GiÃºp cÃ¡c instance má»›i cÃ³ thá»ƒ phá»¥c vá»¥ nhanh chÃ³ng, giáº£m thá»i gian cooldown.

* **Enable detailed monitoring**:

  * KÃ­ch hoáº¡t giÃ¡m sÃ¡t chi tiáº¿t Ä‘á»ƒ cÃ³ **metric má»—i phÃºt** thay vÃ¬ má»—i 5 phÃºt.

---
