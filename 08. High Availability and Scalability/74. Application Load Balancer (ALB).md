# 74. Application Load Balancer (ALB)

## ğŸ”¸ Tá»•ng quan vá» **Application Load Balancer (ALB)**

### âœ… **Äáº·c Ä‘iá»ƒm chÃ­nh cá»§a ALB**
- ALB lÃ  **Layer 7 Load Balancer**, chá»‰ hoáº¡t Ä‘á»™ng á»Ÿ táº§ng HTTP/HTTPS.
- Cho phÃ©p báº¡n **route Ä‘áº¿n nhiá»u á»©ng dá»¥ng HTTP khÃ¡c nhau** trÃªn cÃ¹ng hoáº·c nhiá»u EC2 instance.
- CÃ¡c EC2 nÃ y Ä‘Æ°á»£c **nhÃ³m láº¡i theo Target Group**.
- **Há»— trá»£ nhiá»u giao thá»©c hiá»‡n Ä‘áº¡i**:
  - **HTTP/2**
  - **WebSockets**

---

### âœ… **Kháº£ nÄƒng Ä‘á»‹nh tuyáº¿n (Routing) máº¡nh máº½**
ALB há»— trá»£ nhiá»u cÃ¡ch Ä‘á»‹nh tuyáº¿n thÃ´ng minh Ä‘áº¿n cÃ¡c **Target Group**, bao gá»“m:

1. **Theo Ä‘Æ°á»ng dáº«n (Path)**:
   - VÃ­ dá»¥:  
     - `example.com/users` â†’ Target Group A  
     - `example.com/posts` â†’ Target Group B  

2. **Theo Hostname (Host-based Routing)**:
   - VÃ­ dá»¥:  
     - `user.example.com` â†’ Target Group 1  
     - `admin.example.com` â†’ Target Group 2  

3. **Theo Query String vÃ  Header**:
   - VÃ­ dá»¥:  
     - `example.com/search?platform=Mobile` â†’ Target Group Mobile  
     - `example.com/search?platform=Desktop` â†’ Target Group Desktop  

4. **Redirect HTTP â†’ HTTPS** tá»± Ä‘á»™ng táº¡i ALB.

---

### âœ… **TÃ­ch há»£p tá»‘t vá»›i Microservices & Containers**
- **ALB lÃ  lá»±a chá»n tá»‘i Æ°u** khi triá»ƒn khai kiáº¿n trÃºc microservices vÃ  dÃ¹ng **Docker / Amazon ECS**.
- Há»— trá»£ **dynamic port mapping** trÃªn ECS.
- CÃ³ thá»ƒ thay tháº¿ nhiá»u Classic Load Balancer báº±ng **má»™t ALB duy nháº¥t**, giÃºp Ä‘Æ¡n giáº£n hoÃ¡ kiáº¿n trÃºc há»‡ thá»‘ng.

---

### âœ… **Target Group lÃ  gÃ¬?**
- Target Group lÃ  **táº­p há»£p backend** mÃ  ALB sáº½ route Ä‘áº¿n.
- Má»™t Target Group cÃ³ thá»ƒ bao gá»“m:
  - **EC2 instances**
  - **Auto Scaling Group**
  - **ECS tasks** (container)
  - **Lambda functions** (cho serverless)
  - **Private IP addresses** (dÃ nh cho on-premises server)

> ğŸ”¸ **Health check** Ä‘Æ°á»£c thá»±c hiá»‡n á»Ÿ **má»©c Target Group** Ä‘á»ƒ kiá»ƒm tra tÃ­nh kháº£ dá»¥ng cá»§a tá»«ng backend.

---

### âœ… **VÃ­ dá»¥ minh há»a ALB routing**
Giáº£ sá»­ cÃ³ má»™t ALB Ä‘á»©ng trÆ°á»›c 2 target groups:

1. **Target Group A** (EC2 instances) phá»¥c vá»¥ route `/user`  
2. **Target Group B** (EC2 instances khÃ¡c) phá»¥c vá»¥ route `/search`

â†’ ALB sáº½ tá»± Ä‘á»™ng chuyá»ƒn tiáº¿p request `/user` vÃ  `/search` Ä‘áº¿n Ä‘Ãºng nhÃ³m tÆ°Æ¡ng á»©ng dá»±a trÃªn **routing rule**.

---

### âœ… **TrÆ°á»ng há»£p nÃ¢ng cao: ALB + On-premises server**
- Target Group cÃ³ thá»ƒ chá»©a **server trong data center ná»™i bá»™** (on-prem).
- ALB route traffic Ä‘áº¿n cÃ¡c Ä‘á»‹a chá»‰ **Private IP** Ä‘Ã£ Ä‘Äƒng kÃ½.
- VÃ­ dá»¥ sá»­ dá»¥ng **query string** nhÆ°:
  - `?Platform=Mobile` â†’ Target Group A (EC2 trÃªn AWS)
  - `?Platform=Desktop` â†’ Target Group B (server on-prem)

---

### âœ… **ThÃ´ng tin vá» IP khÃ¡ch truy cáº­p**
- ALB thá»±c hiá»‡n **connection termination**, nÃªn backend **khÃ´ng tháº¥y IP thá»±c cá»§a client**.
- ThÃ´ng tin IP tháº­t Ä‘Æ°á»£c chÃ¨n vÃ o cÃ¡c **header Ä‘áº·c biá»‡t**:
  - `X-Forwarded-For`: IP cá»§a client
  - `X-Forwarded-Port`: Port mÃ  client sá»­ dá»¥ng
  - `X-Forwarded-Proto`: HTTP hoáº·c HTTPS

â†’ Backend cáº§n **Ä‘á»c cÃ¡c header nÃ y** náº¿u muá»‘n ghi log hoáº·c xá»­ lÃ½ dá»±a trÃªn IP client.

---

### âœ… Tá»•ng káº¿t
- **ALB** ráº¥t phÃ¹ há»£p cho há»‡ thá»‘ng hiá»‡n Ä‘áº¡i, dÃ¹ng **microservices, containers, hoáº·c serverless**.
- CÃ³ thá»ƒ xá»­ lÃ½ cÃ¡c yÃªu cáº§u phá»©c táº¡p vá» routing, báº£o máº­t vÃ  tÃ­ch há»£p sÃ¢u vá»›i nhiá»u dá»‹ch vá»¥ AWS.
- GiÃºp tiáº¿t kiá»‡m chi phÃ­, dá»… quáº£n lÃ½ hÆ¡n nhiá»u so vá»›i viá»‡c dÃ¹ng nhiá»u Classic Load Balancer.

---

DÆ°á»›i Ä‘Ã¢y lÃ  sÆ¡ Ä‘á»“ kiáº¿n trÃºc mÃ´ phá»ng **Application Load Balancer (ALB)** vá»›i nhiá»u **Target Group**, sá»­ dá»¥ng **Markdown + sÆ¡ Ä‘á»“ ASCII** Ä‘á»ƒ dá»… hÃ¬nh dung:

---

### ğŸ—‚ï¸ Kiáº¿n trÃºc: ALB routing Ä‘áº¿n nhiá»u á»©ng dá»¥ng backend

```
                +----------------------------+
                |  Application Load Balancer |
                |         (ALB - Public)     |
                +-------------+--------------+
                              |
        +---------------------+----------------------+
        |                                            |
   Route: /users                               Route: /search
        |                                            |
+-------v--------+                           +-------v--------+
|  Target Group A|                           |  Target Group B|
|  (/users path) |                           | (/search path) |
+-------+--------+                           +--------+-------+
        |                                             |
+-------+--------+                         +----------+----------+
| EC2 Instance 1 |                         |  EC2 Instance 2     |
|   (User App)   |                         |  (Search App)       |
+----------------+                         +---------------------+
```

---

### ğŸ“Œ Giáº£i thÃ­ch:
- **ALB**: LÃ  load balancer chÃ­nh, nháº­n toÃ n bá»™ request tá»« ngÆ°á»i dÃ¹ng.
- **Routing theo path**:
  - `/users` â†’ chuyá»ƒn hÆ°á»›ng Ä‘áº¿n **Target Group A** chá»©a cÃ¡c EC2 cháº¡y app "User".
  - `/search` â†’ chuyá»ƒn hÆ°á»›ng Ä‘áº¿n **Target Group B** chá»©a cÃ¡c EC2 cháº¡y app "Search".
- Má»—i Target Group cÃ³ thá»ƒ cÃ³ **nhiá»u EC2 instance** phÃ­a sau.
- **Health Check** Ä‘Æ°á»£c thá»±c hiá»‡n riÃªng cho tá»«ng Target Group.

---

Báº¡n cÅ©ng cÃ³ thá»ƒ má»Ÿ rá»™ng sÆ¡ Ä‘á»“ nÃ y Ä‘á»ƒ route theo **host name**, **query string**, hoáº·c Ä‘áº¿n **Lambda / ECS / IP on-premises** náº¿u cáº§n.
